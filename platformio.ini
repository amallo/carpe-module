[platformio]
default_envs = carpe-lora

[env:carpe-lora]
platform = espressif32
board = ttgo-lora32-v1
framework = arduino
monitor_speed = 115200
upload_speed = 115200
build_flags = 
    -DCONFIG_WIFI_ENABLED=0
    -DCONFIG_FREERTOS_UNICORE=1
    -DBOARD_HAS_PSRAM=0
    -DCONFIG_BT_NIMBLE_ENABLED=1
    -DCONFIG_BT_BLE_ENABLED=0
    -Os
    -DNDEBUG
    -DCORE_DEBUG_LEVEL=0
    -I src
    -I .
build_src_filter = +<main.cpp> +<core/>
lib_deps =
    sandeepmistry/LoRa @ ^0.8.0
    adafruit/Adafruit GFX Library
    adafruit/Adafruit SSD1306
    h2zero/NimBLE-Arduino @ ^1.4.0

; ANCIENNE VERSION : ESP32 BLE classique (plus utilis√©e - garde 813KB Flash)
[env:carpe-lora-legacy]
platform = espressif32
board = ttgo-lora32-v1
framework = arduino
monitor_speed = 115200
upload_speed = 115200
build_flags = 
    -DCONFIG_WIFI_ENABLED=0
    -DCONFIG_FREERTOS_UNICORE=1
    -DBOARD_HAS_PSRAM=0
    -Os
    -DNDEBUG
    -DCORE_DEBUG_LEVEL=0
build_src_filter = +<main.cpp> +<core/>
lib_deps =
    sandeepmistry/LoRa @ ^0.8.0
    adafruit/Adafruit GFX Library
    adafruit/Adafruit SSD1306
    h2zero/NimBLE-Arduino @ ^1.4.0

#[env:sender]
#extends = env:carpe-lora
#src_filter = +<sender.cpp>
#upload_port = /dev/cu.usbserial-583A0089721

#[env:receiver]
#extends = env:carpe-lora
#src_filter = +<receiver.cpp>
#upload_port = /dev/cu.usbserial-51851218391

; Environnement pour les tests sur ESP32 - Simple et efficace
[env:test]
platform = espressif32
board = ttgo-lora32-v1
framework = arduino
monitor_speed = 115200
upload_speed = 115200
build_flags = 
    -DDOCTEST_CONFIG_DISABLE
    -DDOCTEST_CONFIG_NO_SHORT_MACRO_NAMES
    -I .
build_src_filter = +<core/> -<main.cpp>
test_framework = doctest
test_build_src = true
lib_deps =
    sandeepmistry/LoRa @ ^0.8.0
    adafruit/Adafruit GFX Library
    adafruit/Adafruit SSD1306
    h2zero/NimBLE-Arduino @ ^1.4.0

