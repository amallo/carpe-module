# CARPE Module - Architecture Rules

## ğŸ—ï¸ Project Architecture

This project follows Clean Architecture principles with a clear separation between interfaces and implementations.

## ğŸ“ Module Structure Rules

### Standard Module Organization:
```
src/core/[module]/
â”œâ”€â”€ [Module]Provider.h          # Interface du provider
â”œâ”€â”€ [Module]UseCase.h           # Use case (si applicable)
â””â”€â”€ providers/
    â””â”€â”€ infra/
        â””â”€â”€ [Implementation]Provider.*  # ImplÃ©mentations concrÃ¨tes
```

### Alternative for Generators:
```
src/core/[module]/
â”œâ”€â”€ [Module]Generator.h         # Interface du generator
â”œâ”€â”€ [Module]UseCase.h           # Use case (si applicable)
â””â”€â”€ generators/
    â””â”€â”€ infra/
        â””â”€â”€ [Implementation]Generator.*  # ImplÃ©mentations concrÃ¨tes
```

## ğŸ¯ Core Rules

1. **Providers/Generators**: Interfaces are always at the root of the module
2. **Implementations**: Always placed in `providers/infra/` or `generators/infra/`
3. **Use Cases**: Named `XXXXUseCase` and placed at module root
4. **Modules**: Define providers or generators with `infra/` structure and optionally a `XXXUseCase` at root

## ğŸ“‹ Current Module Structure

### Config Module:
```
src/core/config/
â”œâ”€â”€ ConfigProvider.h            # Interface
â””â”€â”€ providers/infra/
    â””â”€â”€ NvsConfigProvider.*     # Implementation
```

### Device Module:
```
src/core/device/
â”œâ”€â”€ SetupDeviceUseCase.h        # Use case at root
â””â”€â”€ generators/
    â”œâ”€â”€ DeviceIdGenerator.h     # Interface
    â””â”€â”€ infra/
        â”œâ”€â”€ MacAddressDeviceIdGenerator.*
        â””â”€â”€ RandomDeviceIdGenerator.*
```

### Random Module:
```
src/core/random/
â”œâ”€â”€ RandomProvider.h            # Interface
â””â”€â”€ providers/infra/
    â””â”€â”€ ArduinoRandomProvider.h # Implementation
```

### Time Module:
```
src/core/time/
â”œâ”€â”€ TimeProvider.h              # Interface
â””â”€â”€ providers/infra/
    â””â”€â”€ ArduinoTimeProvider.h   # Implementation
```

### Transport Module:
```
src/core/transport/
â”œâ”€â”€ BluetoothProvider.h         # Interface
â””â”€â”€ providers/infra/
    â””â”€â”€ ESP32BluetoothProvider.* # Implementation
```

### Logging Module:
```
src/core/logging/
â”œâ”€â”€ Logger.h                    # Interface
â””â”€â”€ providers/infra/
    â”œâ”€â”€ ConsoleLogger.h
    â””â”€â”€ SerialLogger.h
```

## ğŸ”§ Development Guidelines

### When Adding New Modules:
1. Create the interface at module root
2. Create `providers/infra/` or `generators/infra/` subdirectory
3. Place implementations in `infra/`
4. Add use cases at module root if needed
5. Update includes in `main.cpp` and other files

### When Adding New Implementations:
1. Always place in `infra/` subdirectory
2. Follow naming convention: `[Platform/Type][Module]Provider.*`
3. Update all includes to reflect new path

### Include Path Updates:
- Always use relative paths from `infra/` to parent interfaces
- Update `main.cpp` includes when moving files
- Update test files when moving implementations

## âœ… Validation

- All implementations must be in `infra/` subdirectories
- All interfaces must be at module root
- Use cases must be named `XXXXUseCase` and at module root
- Compilation must succeed after any reorganization
- Tests must pass after any reorganization

## ğŸš« Anti-Patterns

- âŒ Don't place implementations at module root
- âŒ Don't create platform-specific folders (arduino/, esp32/, etc.)
- âŒ Don't mix interfaces and implementations in same directory
- âŒ Don't use absolute paths in includes
